fb70ba352240ee4ef7a1ff7a04e328e9
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _EventEmitter = _interopRequireDefault(require("../vendor/emitter/EventEmitter"));
var BatchedBridge = require('../BatchedBridge/BatchedBridge');
var infoLog = require('../Utilities/infoLog');
var TaskQueue = require('./TaskQueue');
var invariant = require('invariant');
var _emitter = new _EventEmitter.default();
var DEBUG_DELAY = 0;
var DEBUG = false;
var InteractionManager = {
  Events: {
    interactionStart: 'interactionStart',
    interactionComplete: 'interactionComplete'
  },
  runAfterInteractions: function runAfterInteractions(task) {
    var tasks = [];
    var promise = new Promise(function (resolve) {
      _scheduleUpdate();
      if (task) {
        tasks.push(task);
      }
      tasks.push({
        run: resolve,
        name: 'resolve ' + (task && task.name || '?')
      });
      _taskQueue.enqueueTasks(tasks);
    });
    return {
      then: promise.then.bind(promise),
      cancel: function cancel() {
        _taskQueue.cancelTasks(tasks);
      }
    };
  },
  createInteractionHandle: function createInteractionHandle() {
    DEBUG && infoLog('InteractionManager: create interaction handle');
    _scheduleUpdate();
    var handle = ++_inc;
    _addInteractionSet.add(handle);
    return handle;
  },
  clearInteractionHandle: function clearInteractionHandle(handle) {
    DEBUG && infoLog('InteractionManager: clear interaction handle');
    invariant(!!handle, 'InteractionManager: Must provide a handle to clear.');
    _scheduleUpdate();
    _addInteractionSet.delete(handle);
    _deleteInteractionSet.add(handle);
  },
  addListener: _emitter.addListener.bind(_emitter),
  setDeadline: function setDeadline(deadline) {
    _deadline = deadline;
  }
};
var _interactionSet = new Set();
var _addInteractionSet = new Set();
var _deleteInteractionSet = new Set();
var _taskQueue = new TaskQueue({
  onMoreTasks: _scheduleUpdate
});
var _nextUpdateHandle = 0;
var _inc = 0;
var _deadline = -1;
function _scheduleUpdate() {
  if (!_nextUpdateHandle) {
    if (_deadline > 0) {
      _nextUpdateHandle = setTimeout(_processUpdate, 0 + DEBUG_DELAY);
    } else {
      _nextUpdateHandle = setImmediate(_processUpdate);
    }
  }
}
function _processUpdate() {
  _nextUpdateHandle = 0;
  var interactionCount = _interactionSet.size;
  _addInteractionSet.forEach(function (handle) {
    return _interactionSet.add(handle);
  });
  _deleteInteractionSet.forEach(function (handle) {
    return _interactionSet.delete(handle);
  });
  var nextInteractionCount = _interactionSet.size;
  if (interactionCount !== 0 && nextInteractionCount === 0) {
    _emitter.emit(InteractionManager.Events.interactionComplete);
  } else if (interactionCount === 0 && nextInteractionCount !== 0) {
    _emitter.emit(InteractionManager.Events.interactionStart);
  }
  if (nextInteractionCount === 0) {
    while (_taskQueue.hasTasksToProcess()) {
      _taskQueue.processNext();
      if (_deadline > 0 && BatchedBridge.getEventLoopRunningTime() >= _deadline) {
        _scheduleUpdate();
        break;
      }
    }
  }
  _addInteractionSet.clear();
  _deleteInteractionSet.clear();
}
module.exports = InteractionManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCYXRjaGVkQnJpZGdlIiwicmVxdWlyZSIsImluZm9Mb2ciLCJUYXNrUXVldWUiLCJpbnZhcmlhbnQiLCJfZW1pdHRlciIsIkV2ZW50RW1pdHRlciIsIkRFQlVHX0RFTEFZIiwiREVCVUciLCJJbnRlcmFjdGlvbk1hbmFnZXIiLCJFdmVudHMiLCJpbnRlcmFjdGlvblN0YXJ0IiwiaW50ZXJhY3Rpb25Db21wbGV0ZSIsInJ1bkFmdGVySW50ZXJhY3Rpb25zIiwidGFzayIsInRhc2tzIiwicHJvbWlzZSIsIlByb21pc2UiLCJyZXNvbHZlIiwiX3NjaGVkdWxlVXBkYXRlIiwicHVzaCIsInJ1biIsIm5hbWUiLCJfdGFza1F1ZXVlIiwiZW5xdWV1ZVRhc2tzIiwidGhlbiIsImJpbmQiLCJjYW5jZWwiLCJjYW5jZWxUYXNrcyIsImNyZWF0ZUludGVyYWN0aW9uSGFuZGxlIiwiaGFuZGxlIiwiX2luYyIsIl9hZGRJbnRlcmFjdGlvblNldCIsImFkZCIsImNsZWFySW50ZXJhY3Rpb25IYW5kbGUiLCJkZWxldGUiLCJfZGVsZXRlSW50ZXJhY3Rpb25TZXQiLCJhZGRMaXN0ZW5lciIsInNldERlYWRsaW5lIiwiZGVhZGxpbmUiLCJfZGVhZGxpbmUiLCJfaW50ZXJhY3Rpb25TZXQiLCJTZXQiLCJvbk1vcmVUYXNrcyIsIl9uZXh0VXBkYXRlSGFuZGxlIiwic2V0VGltZW91dCIsIl9wcm9jZXNzVXBkYXRlIiwic2V0SW1tZWRpYXRlIiwiaW50ZXJhY3Rpb25Db3VudCIsInNpemUiLCJmb3JFYWNoIiwibmV4dEludGVyYWN0aW9uQ291bnQiLCJlbWl0IiwiaGFzVGFza3NUb1Byb2Nlc3MiLCJwcm9jZXNzTmV4dCIsImdldEV2ZW50TG9vcFJ1bm5pbmdUaW1lIiwiY2xlYXIiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiSW50ZXJhY3Rpb25NYW5hZ2VyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBNZXRhIFBsYXRmb3JtcywgSW5jLiBhbmQgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZm9ybWF0XG4gKiBAZmxvdyBzdHJpY3QtbG9jYWxcbiAqL1xuXG5pbXBvcnQgdHlwZSB7VGFza30gZnJvbSAnLi9UYXNrUXVldWUnO1xuXG5pbXBvcnQgRXZlbnRFbWl0dGVyIGZyb20gJy4uL3ZlbmRvci9lbWl0dGVyL0V2ZW50RW1pdHRlcic7XG5cbmNvbnN0IEJhdGNoZWRCcmlkZ2UgPSByZXF1aXJlKCcuLi9CYXRjaGVkQnJpZGdlL0JhdGNoZWRCcmlkZ2UnKTtcbmNvbnN0IGluZm9Mb2cgPSByZXF1aXJlKCcuLi9VdGlsaXRpZXMvaW5mb0xvZycpO1xuY29uc3QgVGFza1F1ZXVlID0gcmVxdWlyZSgnLi9UYXNrUXVldWUnKTtcbmNvbnN0IGludmFyaWFudCA9IHJlcXVpcmUoJ2ludmFyaWFudCcpO1xuXG5leHBvcnQgdHlwZSBIYW5kbGUgPSBudW1iZXI7XG5cbmNvbnN0IF9lbWl0dGVyID0gbmV3IEV2ZW50RW1pdHRlcjx7XG4gIGludGVyYWN0aW9uQ29tcGxldGU6IFtdLFxuICBpbnRlcmFjdGlvblN0YXJ0OiBbXSxcbn0+KCk7XG5cbmNvbnN0IERFQlVHX0RFTEFZOiAwID0gMDtcbmNvbnN0IERFQlVHOiBmYWxzZSA9IGZhbHNlO1xuXG4vKipcbiAqIEludGVyYWN0aW9uTWFuYWdlciBhbGxvd3MgbG9uZy1ydW5uaW5nIHdvcmsgdG8gYmUgc2NoZWR1bGVkIGFmdGVyIGFueVxuICogaW50ZXJhY3Rpb25zL2FuaW1hdGlvbnMgaGF2ZSBjb21wbGV0ZWQuIEluIHBhcnRpY3VsYXIsIHRoaXMgYWxsb3dzIEphdmFTY3JpcHRcbiAqIGFuaW1hdGlvbnMgdG8gcnVuIHNtb290aGx5LlxuICpcbiAqIEFwcGxpY2F0aW9ucyBjYW4gc2NoZWR1bGUgdGFza3MgdG8gcnVuIGFmdGVyIGludGVyYWN0aW9ucyB3aXRoIHRoZSBmb2xsb3dpbmc6XG4gKlxuICogYGBgXG4gKiBJbnRlcmFjdGlvbk1hbmFnZXIucnVuQWZ0ZXJJbnRlcmFjdGlvbnMoKCkgPT4ge1xuICogICAvLyAuLi5sb25nLXJ1bm5pbmcgc3luY2hyb25vdXMgdGFzay4uLlxuICogfSk7XG4gKiBgYGBcbiAqXG4gKiBDb21wYXJlIHRoaXMgdG8gb3RoZXIgc2NoZWR1bGluZyBhbHRlcm5hdGl2ZXM6XG4gKlxuICogLSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKTogZm9yIGNvZGUgdGhhdCBhbmltYXRlcyBhIHZpZXcgb3ZlciB0aW1lLlxuICogLSBzZXRJbW1lZGlhdGUvc2V0VGltZW91dCgpOiBydW4gY29kZSBsYXRlciwgbm90ZSB0aGlzIG1heSBkZWxheSBhbmltYXRpb25zLlxuICogLSBydW5BZnRlckludGVyYWN0aW9ucygpOiBydW4gY29kZSBsYXRlciwgd2l0aG91dCBkZWxheWluZyBhY3RpdmUgYW5pbWF0aW9ucy5cbiAqXG4gKiBUaGUgdG91Y2ggaGFuZGxpbmcgc3lzdGVtIGNvbnNpZGVycyBvbmUgb3IgbW9yZSBhY3RpdmUgdG91Y2hlcyB0byBiZSBhblxuICogJ2ludGVyYWN0aW9uJyBhbmQgd2lsbCBkZWxheSBgcnVuQWZ0ZXJJbnRlcmFjdGlvbnMoKWAgY2FsbGJhY2tzIHVudGlsIGFsbFxuICogdG91Y2hlcyBoYXZlIGVuZGVkIG9yIGJlZW4gY2FuY2VsbGVkLlxuICpcbiAqIEludGVyYWN0aW9uTWFuYWdlciBhbHNvIGFsbG93cyBhcHBsaWNhdGlvbnMgdG8gcmVnaXN0ZXIgYW5pbWF0aW9ucyBieVxuICogY3JlYXRpbmcgYW4gaW50ZXJhY3Rpb24gJ2hhbmRsZScgb24gYW5pbWF0aW9uIHN0YXJ0LCBhbmQgY2xlYXJpbmcgaXQgdXBvblxuICogY29tcGxldGlvbjpcbiAqXG4gKiBgYGBcbiAqIHZhciBoYW5kbGUgPSBJbnRlcmFjdGlvbk1hbmFnZXIuY3JlYXRlSW50ZXJhY3Rpb25IYW5kbGUoKTtcbiAqIC8vIHJ1biBhbmltYXRpb24uLi4gKGBydW5BZnRlckludGVyYWN0aW9uc2AgdGFza3MgYXJlIHF1ZXVlZClcbiAqIC8vIGxhdGVyLCBvbiBhbmltYXRpb24gY29tcGxldGlvbjpcbiAqIEludGVyYWN0aW9uTWFuYWdlci5jbGVhckludGVyYWN0aW9uSGFuZGxlKGhhbmRsZSk7XG4gKiAvLyBxdWV1ZWQgdGFza3MgcnVuIGlmIGFsbCBoYW5kbGVzIHdlcmUgY2xlYXJlZFxuICogYGBgXG4gKlxuICogYHJ1bkFmdGVySW50ZXJhY3Rpb25zYCB0YWtlcyBlaXRoZXIgYSBwbGFpbiBjYWxsYmFjayBmdW5jdGlvbiwgb3IgYVxuICogYFByb21pc2VUYXNrYCBvYmplY3Qgd2l0aCBhIGBnZW5gIG1ldGhvZCB0aGF0IHJldHVybnMgYSBgUHJvbWlzZWAuICBJZiBhXG4gKiBgUHJvbWlzZVRhc2tgIGlzIHN1cHBsaWVkLCB0aGVuIGl0IGlzIGZ1bGx5IHJlc29sdmVkIChpbmNsdWRpbmcgYXN5bmNocm9ub3VzXG4gKiBkZXBlbmRlbmNpZXMgdGhhdCBhbHNvIHNjaGVkdWxlIG1vcmUgdGFza3MgdmlhIGBydW5BZnRlckludGVyYWN0aW9uc2ApIGJlZm9yZVxuICogc3RhcnRpbmcgb24gdGhlIG5leHQgdGFzayB0aGF0IG1pZ2h0IGhhdmUgYmVlbiBxdWV1ZWQgdXAgc3luY2hyb25vdXNseVxuICogZWFybGllci5cbiAqXG4gKiBCeSBkZWZhdWx0LCBxdWV1ZWQgdGFza3MgYXJlIGV4ZWN1dGVkIHRvZ2V0aGVyIGluIGEgbG9vcCBpbiBvbmVcbiAqIGBzZXRJbW1lZGlhdGVgIGJhdGNoLiBJZiBgc2V0RGVhZGxpbmVgIGlzIGNhbGxlZCB3aXRoIGEgcG9zaXRpdmUgbnVtYmVyLCB0aGVuXG4gKiB0YXNrcyB3aWxsIG9ubHkgYmUgZXhlY3V0ZWQgdW50aWwgdGhlIGRlYWRsaW5lIChpbiB0ZXJtcyBvZiBqcyBldmVudCBsb29wIHJ1blxuICogdGltZSkgYXBwcm9hY2hlcywgYXQgd2hpY2ggcG9pbnQgZXhlY3V0aW9uIHdpbGwgeWllbGQgdmlhIHNldFRpbWVvdXQsXG4gKiBhbGxvd2luZyBldmVudHMgc3VjaCBhcyB0b3VjaGVzIHRvIHN0YXJ0IGludGVyYWN0aW9ucyBhbmQgYmxvY2sgcXVldWVkIHRhc2tzXG4gKiBmcm9tIGV4ZWN1dGluZywgbWFraW5nIGFwcHMgbW9yZSByZXNwb25zaXZlLlxuICovXG5jb25zdCBJbnRlcmFjdGlvbk1hbmFnZXIgPSB7XG4gIEV2ZW50czoge1xuICAgIGludGVyYWN0aW9uU3RhcnQ6ICdpbnRlcmFjdGlvblN0YXJ0JyxcbiAgICBpbnRlcmFjdGlvbkNvbXBsZXRlOiAnaW50ZXJhY3Rpb25Db21wbGV0ZScsXG4gIH0sXG5cbiAgLyoqXG4gICAqIFNjaGVkdWxlIGEgZnVuY3Rpb24gdG8gcnVuIGFmdGVyIGFsbCBpbnRlcmFjdGlvbnMgaGF2ZSBjb21wbGV0ZWQuIFJldHVybnMgYSBjYW5jZWxsYWJsZVxuICAgKiBcInByb21pc2VcIi5cbiAgICovXG4gIHJ1bkFmdGVySW50ZXJhY3Rpb25zKHRhc2s6ID9UYXNrKToge1xuICAgIHRoZW46IDxVPihcbiAgICAgIG9uRnVsZmlsbD86ID8odm9pZCkgPT4gPyhQcm9taXNlPFU+IHwgVSksXG4gICAgICBvblJlamVjdD86ID8oZXJyb3I6IG1peGVkKSA9PiA/KFByb21pc2U8VT4gfCBVKSxcbiAgICApID0+IFByb21pc2U8VT4sXG4gICAgY2FuY2VsOiAoKSA9PiB2b2lkLFxuICAgIC4uLlxuICB9IHtcbiAgICBjb25zdCB0YXNrczogQXJyYXk8VGFzaz4gPSBbXTtcbiAgICBjb25zdCBwcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmU6ICgpID0+IHZvaWQpID0+IHtcbiAgICAgIF9zY2hlZHVsZVVwZGF0ZSgpO1xuICAgICAgaWYgKHRhc2spIHtcbiAgICAgICAgdGFza3MucHVzaCh0YXNrKTtcbiAgICAgIH1cbiAgICAgIHRhc2tzLnB1c2goe1xuICAgICAgICBydW46IHJlc29sdmUsXG4gICAgICAgIG5hbWU6ICdyZXNvbHZlICcgKyAoKHRhc2sgJiYgdGFzay5uYW1lKSB8fCAnPycpLFxuICAgICAgfSk7XG4gICAgICBfdGFza1F1ZXVlLmVucXVldWVUYXNrcyh0YXNrcyk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIC8vICRGbG93Rml4TWVbbWV0aG9kLXVuYmluZGluZ10gYWRkZWQgd2hlbiBpbXByb3ZpbmcgdHlwaW5nIGZvciB0aGlzIHBhcmFtZXRlcnNcbiAgICAgIHRoZW46IHByb21pc2UudGhlbi5iaW5kKHByb21pc2UpLFxuICAgICAgY2FuY2VsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIF90YXNrUXVldWUuY2FuY2VsVGFza3ModGFza3MpO1xuICAgICAgfSxcbiAgICB9O1xuICB9LFxuXG4gIC8qKlxuICAgKiBOb3RpZnkgbWFuYWdlciB0aGF0IGFuIGludGVyYWN0aW9uIGhhcyBzdGFydGVkLlxuICAgKi9cbiAgY3JlYXRlSW50ZXJhY3Rpb25IYW5kbGUoKTogSGFuZGxlIHtcbiAgICBERUJVRyAmJiBpbmZvTG9nKCdJbnRlcmFjdGlvbk1hbmFnZXI6IGNyZWF0ZSBpbnRlcmFjdGlvbiBoYW5kbGUnKTtcbiAgICBfc2NoZWR1bGVVcGRhdGUoKTtcbiAgICBjb25zdCBoYW5kbGUgPSArK19pbmM7XG4gICAgX2FkZEludGVyYWN0aW9uU2V0LmFkZChoYW5kbGUpO1xuICAgIHJldHVybiBoYW5kbGU7XG4gIH0sXG5cbiAgLyoqXG4gICAqIE5vdGlmeSBtYW5hZ2VyIHRoYXQgYW4gaW50ZXJhY3Rpb24gaGFzIGNvbXBsZXRlZC5cbiAgICovXG4gIGNsZWFySW50ZXJhY3Rpb25IYW5kbGUoaGFuZGxlOiBIYW5kbGUpIHtcbiAgICBERUJVRyAmJiBpbmZvTG9nKCdJbnRlcmFjdGlvbk1hbmFnZXI6IGNsZWFyIGludGVyYWN0aW9uIGhhbmRsZScpO1xuICAgIGludmFyaWFudCghIWhhbmRsZSwgJ0ludGVyYWN0aW9uTWFuYWdlcjogTXVzdCBwcm92aWRlIGEgaGFuZGxlIHRvIGNsZWFyLicpO1xuICAgIF9zY2hlZHVsZVVwZGF0ZSgpO1xuICAgIF9hZGRJbnRlcmFjdGlvblNldC5kZWxldGUoaGFuZGxlKTtcbiAgICBfZGVsZXRlSW50ZXJhY3Rpb25TZXQuYWRkKGhhbmRsZSk7XG4gIH0sXG5cbiAgLy8gJEZsb3dGaXhNZVttZXRob2QtdW5iaW5kaW5nXSBhZGRlZCB3aGVuIGltcHJvdmluZyB0eXBpbmcgZm9yIHRoaXMgcGFyYW1ldGVyc1xuICBhZGRMaXN0ZW5lcjogKF9lbWl0dGVyLmFkZExpc3RlbmVyLmJpbmQoX2VtaXR0ZXIpOiAkRmxvd0ZpeE1lKSxcblxuICAvKipcbiAgICogQSBwb3NpdGl2ZSBudW1iZXIgd2lsbCB1c2Ugc2V0VGltZW91dCB0byBzY2hlZHVsZSBhbnkgdGFza3MgYWZ0ZXIgdGhlXG4gICAqIGV2ZW50TG9vcFJ1bm5pbmdUaW1lIGhpdHMgdGhlIGRlYWRsaW5lIHZhbHVlLCBvdGhlcndpc2UgYWxsIHRhc2tzIHdpbGwgYmVcbiAgICogZXhlY3V0ZWQgaW4gb25lIHNldEltbWVkaWF0ZSBiYXRjaCAoZGVmYXVsdCkuXG4gICAqL1xuICBzZXREZWFkbGluZShkZWFkbGluZTogbnVtYmVyKSB7XG4gICAgX2RlYWRsaW5lID0gZGVhZGxpbmU7XG4gIH0sXG59O1xuXG5jb25zdCBfaW50ZXJhY3Rpb25TZXQgPSBuZXcgU2V0PG51bWJlciB8IEhhbmRsZT4oKTtcbmNvbnN0IF9hZGRJbnRlcmFjdGlvblNldCA9IG5ldyBTZXQ8bnVtYmVyIHwgSGFuZGxlPigpO1xuY29uc3QgX2RlbGV0ZUludGVyYWN0aW9uU2V0ID0gbmV3IFNldDxIYW5kbGU+KCk7XG5jb25zdCBfdGFza1F1ZXVlID0gbmV3IFRhc2tRdWV1ZSh7b25Nb3JlVGFza3M6IF9zY2hlZHVsZVVwZGF0ZX0pO1xubGV0IF9uZXh0VXBkYXRlSGFuZGxlOiAkRmxvd0ZpeE1lIHwgVGltZW91dElEID0gMDtcbmxldCBfaW5jID0gMDtcbmxldCBfZGVhZGxpbmUgPSAtMTtcblxuLyoqXG4gKiBTY2hlZHVsZSBhbiBhc3luY2hyb25vdXMgdXBkYXRlIHRvIHRoZSBpbnRlcmFjdGlvbiBzdGF0ZS5cbiAqL1xuZnVuY3Rpb24gX3NjaGVkdWxlVXBkYXRlKCkge1xuICBpZiAoIV9uZXh0VXBkYXRlSGFuZGxlKSB7XG4gICAgaWYgKF9kZWFkbGluZSA+IDApIHtcbiAgICAgIF9uZXh0VXBkYXRlSGFuZGxlID0gc2V0VGltZW91dChfcHJvY2Vzc1VwZGF0ZSwgMCArIERFQlVHX0RFTEFZKTtcbiAgICB9IGVsc2Uge1xuICAgICAgX25leHRVcGRhdGVIYW5kbGUgPSBzZXRJbW1lZGlhdGUoX3Byb2Nlc3NVcGRhdGUpO1xuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIE5vdGlmeSBsaXN0ZW5lcnMsIHByb2Nlc3MgcXVldWUsIGV0Y1xuICovXG5mdW5jdGlvbiBfcHJvY2Vzc1VwZGF0ZSgpIHtcbiAgX25leHRVcGRhdGVIYW5kbGUgPSAwO1xuXG4gIGNvbnN0IGludGVyYWN0aW9uQ291bnQgPSBfaW50ZXJhY3Rpb25TZXQuc2l6ZTtcbiAgX2FkZEludGVyYWN0aW9uU2V0LmZvckVhY2goaGFuZGxlID0+IF9pbnRlcmFjdGlvblNldC5hZGQoaGFuZGxlKSk7XG4gIF9kZWxldGVJbnRlcmFjdGlvblNldC5mb3JFYWNoKGhhbmRsZSA9PiBfaW50ZXJhY3Rpb25TZXQuZGVsZXRlKGhhbmRsZSkpO1xuICBjb25zdCBuZXh0SW50ZXJhY3Rpb25Db3VudCA9IF9pbnRlcmFjdGlvblNldC5zaXplO1xuXG4gIGlmIChpbnRlcmFjdGlvbkNvdW50ICE9PSAwICYmIG5leHRJbnRlcmFjdGlvbkNvdW50ID09PSAwKSB7XG4gICAgLy8gdHJhbnNpdGlvbiBmcm9tIDErIC0tPiAwIGludGVyYWN0aW9uc1xuICAgIF9lbWl0dGVyLmVtaXQoSW50ZXJhY3Rpb25NYW5hZ2VyLkV2ZW50cy5pbnRlcmFjdGlvbkNvbXBsZXRlKTtcbiAgfSBlbHNlIGlmIChpbnRlcmFjdGlvbkNvdW50ID09PSAwICYmIG5leHRJbnRlcmFjdGlvbkNvdW50ICE9PSAwKSB7XG4gICAgLy8gdHJhbnNpdGlvbiBmcm9tIDAgLS0+IDErIGludGVyYWN0aW9uc1xuICAgIF9lbWl0dGVyLmVtaXQoSW50ZXJhY3Rpb25NYW5hZ2VyLkV2ZW50cy5pbnRlcmFjdGlvblN0YXJ0KTtcbiAgfVxuXG4gIC8vIHByb2Nlc3MgdGhlIHF1ZXVlIHJlZ2FyZGxlc3Mgb2YgYSB0cmFuc2l0aW9uXG4gIGlmIChuZXh0SW50ZXJhY3Rpb25Db3VudCA9PT0gMCkge1xuICAgIHdoaWxlIChfdGFza1F1ZXVlLmhhc1Rhc2tzVG9Qcm9jZXNzKCkpIHtcbiAgICAgIF90YXNrUXVldWUucHJvY2Vzc05leHQoKTtcbiAgICAgIGlmIChcbiAgICAgICAgX2RlYWRsaW5lID4gMCAmJlxuICAgICAgICBCYXRjaGVkQnJpZGdlLmdldEV2ZW50TG9vcFJ1bm5pbmdUaW1lKCkgPj0gX2RlYWRsaW5lXG4gICAgICApIHtcbiAgICAgICAgLy8gSGl0IGRlYWRsaW5lIGJlZm9yZSBwcm9jZXNzaW5nIGFsbCB0YXNrcywgc28gcHJvY2VzcyBtb3JlIGxhdGVyLlxuICAgICAgICBfc2NoZWR1bGVVcGRhdGUoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIF9hZGRJbnRlcmFjdGlvblNldC5jbGVhcigpO1xuICBfZGVsZXRlSW50ZXJhY3Rpb25TZXQuY2xlYXIoKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBJbnRlcmFjdGlvbk1hbmFnZXI7XG4iXSwibWFwcGluZ3MiOiI7QUFZQTtBQUVBLElBQU1BLGFBQWEsR0FBR0MsT0FBTyxDQUFDLGdDQUFnQyxDQUFDO0FBQy9ELElBQU1DLE9BQU8sR0FBR0QsT0FBTyxDQUFDLHNCQUFzQixDQUFDO0FBQy9DLElBQU1FLFNBQVMsR0FBR0YsT0FBTyxDQUFDLGFBQWEsQ0FBQztBQUN4QyxJQUFNRyxTQUFTLEdBQUdILE9BQU8sQ0FBQyxXQUFXLENBQUM7QUFJdEMsSUFBTUksUUFBUSxHQUFH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